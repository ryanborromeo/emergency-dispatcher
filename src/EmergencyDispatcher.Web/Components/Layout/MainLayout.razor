@inherits LayoutComponentBase

<MudThemeProvider @ref="_themeProvider" Theme="_emergencyTheme" IsDarkMode="true" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="2" Dense="true">
        <MudIconButton Icon="@Icons.Material.Filled.Menu"
                       Color="Color.Inherit"
                       Edge="Edge.Start"
                       OnClick="ToggleDrawer" />
        <MudIcon Icon="@Icons.Material.Filled.LocalHospital" Class="mr-2" />
        <MudText Typo="Typo.h6" Class="mr-4">Emergency Dispatch</MudText>
        <MudSpacer />
        <AuthorizeView>
            <Authorized>
                <MudText Typo="Typo.body2" Class="mr-4">@context.User.Identity?.Name</MudText>
                <form method="post" action="/logout">
                    <AntiforgeryToken />
                    <MudButton ButtonType="ButtonType.Submit"
                               Variant="Variant.Text"
                               Color="Color.Inherit"
                               StartIcon="@Icons.Material.Filled.Logout"
                               Size="Size.Small">
                        Logout
                    </MudButton>
                </form>
            </Authorized>
        </AuthorizeView>
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Elevation="1" Variant="DrawerVariant.Responsive">
        <NavMenu />
    </MudDrawer>

    <MudMainContent Class="pt-16 px-4">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4 mb-8">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private MudThemeProvider _themeProvider = default!;

    private readonly MudTheme _emergencyTheme = new()
    {
        PaletteLight = new PaletteLight
        {
            Primary = "#B71C1C",
            Secondary = "#FFA000",
            AppbarBackground = "#0f3460",
            Background = "#f5f5f5",
            Surface = "#ffffff"
        },
        PaletteDark = new PaletteDark
        {
            Primary = "#EF5350",
            Secondary = "#FFB300",
            Background = "#1a1a2e",
            Surface = "#16213e",
            AppbarBackground = "#0f3460",
            DrawerBackground = "#0f3460",
            DrawerText = "rgba(255,255,255,0.85)",
            DrawerIcon = "rgba(255,255,255,0.85)",
            TextPrimary = "rgba(255,255,255,0.90)",
            TextSecondary = "rgba(255,255,255,0.60)",
            ActionDefault = "rgba(255,255,255,0.70)",
            ActionDisabled = "rgba(255,255,255,0.26)",
            ActionDisabledBackground = "rgba(255,255,255,0.12)"
        },
        Typography = new Typography
        {
            Default = new DefaultTypography
            {
                FontFamily = ["Roboto", "Helvetica", "Arial", "sans-serif"]
            }
        }
    };

    private void ToggleDrawer() => _drawerOpen = !_drawerOpen;
}
